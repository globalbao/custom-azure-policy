{
    "mode":"All",
    "parameters":{
    },
    "policyRule":{
       "if":{
          "allOf":[
             {
                "field":"type",
                "equals":"Microsoft.Network/loadBalancers"
             },
             {
                "field":"Microsoft.Network/loadBalancers/sku.name",
                "equals":"Standard"
             }
          ]
       },
       "then":{
          "effect":"deployIfNotExists",
          "details":{
             "roleDefinitionIds":[
                "/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
             ],
             "type":"Microsoft.Insights/metricAlerts",
             "existenceCondition":{
                "allOf":[
                   {
                      "field":"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricNamespace",
                      "equals":"Microsoft.Network/loadBalancers"
                   },
                   {
                      "field":"Microsoft.Insights/metricAlerts/criteria.Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria.allOf[*].metricName",
                      "equals":"DipAvailability"
                   },
                   {
                      "field":"Microsoft.Insights/metricalerts/scopes[*]",
                      "equals":"[concat(subscription().id, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Network/loadBalancers/', field('fullName'))]"
                   }
                ]
             },
             "deployment":{
                "properties":{
                   "mode":"incremental",
                   "template":{
                      "$schema":"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion":"1.0.0.0",
                      "parameters":{
                         "resourceName":{
                            "type":"string",
                            "metadata":{
                               "displayName":"resourceName",
                               "description":"Name of the resource"
                            }
                         },
                         "actionGroupName":{
                            "type":"string",
                            "metadata":{
                               "displayName":"actionGroupName",
                               "description":"Name of the Action Group"
                            }
                         },
                         "actionGroupRG":{
                            "type":"string",
                            "metadata":{
                               "displayName":"actionGroupRG",
                               "description":"Resource Group containing the Action Group"
                            }
                         },
                         "resourceId":{
                            "type":"string",
                            "metadata":{
                               "displayName":"resourceId",
                               "description":"Resource ID of the resource emitting the metric that will be used for the comparison"
                            },
                            "defaultValue":"[resourceId('Microsoft.Network/loadBalancers', parameters('resourceName'))]"
                         },
                         "resourceLocation":{
                            "type":"string",
                            "metadata":{
                               "displayName":"resourceLocation",
                               "description":"Location of the resource"
                            }
                         },
                         "actionGroupId":{
                            "type":"string",
                            "metadata":{
                               "displayName":"actionGroupId",
                               "description":"The ID of the action group that is triggered when the alert is activated or deactivated"
                            },
                            "defaultValue":"[resourceId(parameters('actionGroupRG'), 'Microsoft.Insights/ActionGroups', parameters('actionGroupName'))]"
                         }
                      },
                      "variables":{
                         
                      },
                      "resources":[
                         {
                            "type":"Microsoft.Insights/metricAlerts",
                            "apiVersion":"2018-03-01",
                            "name":"[concat(parameters('resourceName'), '-loadBalancer_DipAvailability')]",
                            "location":"global",
                            "properties":{
                               "description":"Average Load Balancer health probe status per time duration",
                               "severity":2,
                               "enabled":true,
                               "scopes":[
                                  "[parameters('resourceId')]"
                               ],
                               "evaluationFrequency":"PT15M",
                               "windowSize":"PT1H",
                               "criteria":{
                                  "allOf":[
                                     {
                                        "alertSensitivity":"Medium",
                                        "failingPeriods":{
                                           "numberOfEvaluationPeriods":2,
                                           "minFailingPeriodsToAlert":1
                                        },
                                        "name":"Metric1",
                                        "metricNamespace":"Microsoft.Network/loadBalancers",
                                        "metricName":"DipAvailability",
                                        "dimensions":[
                                           {
                                              "name":"ProtocolType",
                                              "operator":"Include",
                                              "values":[
                                                 "*"
                                              ]
                                           },
                                           {
                                              "name":"FrontendIPAddress",
                                              "operator":"Include",
                                              "values":[
                                                 "*"
                                              ]
                                           },
                                           {
                                              "name":"BackendIPAddress",
                                              "operator":"Include",
                                              "values":[
                                                 "*"
                                              ]
                                           }
                                        ],
                                        "operator":"LessThan",
                                        "timeAggregation":"Average",
                                        "criterionType":"DynamicThresholdCriterion"
                                     }
                                  ],
                                  "odata.type":"Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria"
                               },
                               "autoMitigate":true,
                               "targetResourceType":"Microsoft.Network/loadBalancers",
                               "targetResourceRegion":"[parameters('resourceLocation')]",
                               "actions":[
                                  {
                                     "actionGroupId":"[parameters('actionGroupId')]",
                                     "webHookProperties":{
                                        
                                     }
                                  }
                               ]
                            }
                         }
                      ]
                   },
                   "parameters":{
                      "resourceName":{
                         "value":"[field('fullName')]"
                      },
                      "resourceLocation":{
                         "value":"[field('location')]"
                      },
                      "actionGroupName":{
                         "value":"update with your action group name"
                      },
                      "actionGroupRG":{
                         "value":"update with your action group RG name"
                      }
                   }
                }
             }
          }
       }
    }
}