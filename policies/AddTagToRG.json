{
  "name": "AddTagToRG",
  "type": "Microsoft.Authorization/policyDefinitions",
  "apiVersion": "2019-06-01",
  "properties": {
      "policyType": "Custom",
      "mode": "All",
      "displayName": "AddTagToRG",
      "description": "Adds the mandatory tag key when any resource group missing this tag is created or updated. \nExisting resource groups can be remediated by triggering a remediation task.\nIf the tag exists with a different value it will not be changed.",
      "metadata": {
        "version": "1.0.0",
        "category": "Custom-Tags"
      },
      "policyRule": {
        "if": {
          "allOf": [
            {
              "field": "type",
              "equals": "Microsoft.Resources/subscriptions/resourceGroups"
            },
            {
              "field": "[concat('tags[', parameters('tagName'), ']')]",
              "exists": "false"
            }
          ]
        },
        "then": {
          "effect": "modify",
          "details": {
            "roleDefinitionIds": [
              "/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
            ],
            "operations": [
              {
                "operation": "add",
                "field": "[concat('tags[', parameters('tagName'), ']')]",
                "value": "[parameters('tagValue')]"
              }
            ]
          }
        }
      },
      "parameters": {
        "tagName": {
          "type": "String",
          "metadata": {
            "displayName": "Mandatory Tag [ExampleTag]",
            "description": "Name of the tag e.g. ExampleTag"
          },
          "defaultValue": "ExampleTag"
        },
        "tagValue": {
          "type": "String",
          "metadata": {
            "displayName": "Tag Value",
            "description": "Value of the tag e.g. TBC"
          },
          "defaultValue": "TBC"
        }
      }
  }
}